using UnityEngine;

public class Splitter : MonoBehaviour
{
    private int _minQuantityCubes = 2;
    private int _maxQuantityCubes = 6;
    private float _splitChance;
    private float _randomNumber;

    private void Awake()
    {
        _splitChance = 1f;
    }

    private void OnMouseDown()
    {
        _randomNumber = Random.value;

        if (_randomNumber <= _splitChance)
        {
            Split();
        }

        Destroy(gameObject);
    }

    public void SetSplitChance(float splitChance)
    {
        _splitChance = splitChance;
    }

    private void Split()
    {
        int splitCount = Random.Range(_minQuantityCubes, _maxQuantityCubes + 1);

        for (int i = 0; i < splitCount; i++)
        {
            float offsetRadius = 0.5f;

            Vector3 randomOffset = Random.insideUnitSphere * offsetRadius;

            Vector3 newPosition = transform.position + randomOffset;

            Vector3 newScale = transform.localScale / 2f;

            float newSplitChance = _splitChance / 2f;

            EventBus.OnClick?.Invoke(EventBus.OnSplit?.Invoke(newPosition, newScale, newSplitChance));
        }
    }
}
